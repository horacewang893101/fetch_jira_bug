# MP-371: Hardcoded database & superuser credentials in init-pv-files spec

**Status:** Backlog

**Assignee:** Unassigned

**Description:**
The {{init-pv-files}} Job spec on AKS defines sensitive credentials directly in the Pod environment ({{DB_USER}}, {{DB_PASSWD}}, {{SERVICEME_SUPERUSER_PWD}}). This exposes secrets to anyone with read access to the cluster or IaC repository, and they may leak via logs, crash dumps, or misconfigurations. It violates secret management best practices.



*Scope (service/file):*

* *Service/Workload:* {{init-pv-files}} (Job)
* *File/Section:* {{spec.template.spec.containers[0].env}}
* *Secrets found (single story):*
** {{DB_USER=postgres}} _(credential)_
** {{DB_PASSWD=postgres}} _(credential)_
** {{SERVICEME_SUPERUSER_PWD=BibHqvL0_W3uu4}} _(credential)_



*Impact:*

* High risk of credential leakage and unauthorized access to the database and application superuser account.
* Potential compromise of data integrity and privilege escalation using the superuser.
* Fails compliance/security posture (e.g., SOC2/ISO27001) regarding proper secret handling.

*Recommended Fix:*

* *Move all credentials to a secret manager*:
** Preferred: *Azure Key Vault via Secrets Store CSI Driver* (aligned with other workloads already using {{secretProviderClass: azure-keyvault-secrets}}).
* *Do not store secrets in manifests or ConfigMaps.* Mount them as files (via CSI) or inject via env from a Secret.
* *Rotate the credentials* (DB user/pass and superuser pass) immediately after migration.
* *Limit privileges* for the superuser or use a scoped service account with least privilege.
